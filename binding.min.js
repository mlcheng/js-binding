"use strict";function _toConsumableArray(e){if(Array.isArray(e)){for(var n=0,t=Array(e.length);n<e.length;n++)t[n]=e[n];return t}return Array.from(e)}function _defineProperty(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}var iqwerty=iqwerty||{};iqwerty.binding=function(){function e(e,n){j[e]=n}function n(e){return j[e]}function t(e){e.hasOwnProperty(P.iqdb)||(e[P.iqdb]={})}function r(e,n){if(!e[P.iqdb].hasOwnProperty(n)){var t;e[P.iqdb][n]=(t={},_defineProperty(t,P.model,e[n]),_defineProperty(t,P.bindings,[]),_defineProperty(t,P.watchers,[]),t)}}function a(e,n,t){var r=e[P.iqdb][n];t.forEach(function(t){var a=r[P.bindings].find(function(e){return e[P.el]===t[P.el]});if(a){var i;t[P.attrs]=t[P.attrs].filter(function(e){return!~a[P.attrs].indexOf(e)}),(i=a[P.attrs]).push.apply(i,_toConsumableArray(t[P.attrs]))}else{r[P.bindings]=r[P.bindings].concat(t);var o=Object.keys(x).find(function(e){return!!Array.from(t[P.el].parentElement.querySelectorAll(e)).find(function(e){return e===t[P.el]})});o&&x[o][P.changer].forEach(function(r){t[P.el].addEventListener(r,function(){e[n]=t[P.el][x[o][P.value]]})})}})}function i(e,n,t){var r,a=e[P.iqdb][n];a[P.watchers]=(r=a[P.watchers]).concat.apply(r,_toConsumableArray(t))}function o(e,n,t,r){t!==r&&e[P.iqdb][n][P.watchers].forEach(function(e){e(t,r)})}function c(e,n){try{Object.defineProperty(e,n,{get:function(){return e[P.iqdb][n][P.model]},set:function(t){var r=d(e,n);u(e,n,t),f(e,n,t),o(e,n,t,r)}})}catch(e){}}function d(e,n){return e[P.iqdb][n][P.model]}function u(e,n,t){e[P.iqdb][n][P.model]=t}function f(e,n,t){null==t&&(t=""),e[P.iqdb][n][P.bindings].forEach(function(e){e[P.attrs].forEach(function(n){var r=e[P.el];if(new RegExp(P.regex.dataset).test(n)){var a=n.replace(new RegExp(P.regex.dataset),"");r.dataset[a]!==t&&(r.dataset[a]=w(t))}else r[n]!==t&&(r[n]=w(t))})})}function l(e,n){return Array.from(n.querySelectorAll("*")).find(function(n){return!n.firstElementChild&&n.textContent===e})||n}function s(e){var n=new RegExp(P.regex.obj,"g"),t=e.innerHTML;t=t.replace(n,function(n){var t=l(n,e);return P.dataset.bindIncomplete.cc in t.dataset?n:"<span "+P.dataset.bindIncomplete.dash+">"+n+"</span>"}),e.innerHTML!==t&&(e.innerHTML=t)}function p(){var e=document.querySelectorAll("["+P.dataset.bindTo.dash+"]");Array.from(e).forEach(function(e){e.dataset[P.dataset.bindTo.cc].split(";").forEach(function(n){var t,r=n.split(":"),a=r[0].split(",");a=a.map(function(e){return e.trim()});var i=y(r[1],P.regex.variable),o=i.obj,c=i.prop;(o||c)&&h(o,c,(t={},_defineProperty(t,P.el,e),_defineProperty(t,P.attrs,a),t))})})}function b(){var e=document.querySelectorAll("["+P.dataset.bind.dash+"]:not(["+P.dataset.bindWrapped.dash+"]"),n=function(e,n,t){var r;(e||n)&&(h(e,n,(r={},_defineProperty(r,P.el,t),_defineProperty(r,P.attrs,["innerHTML"]),r)),delete t.dataset[P.dataset.bindIncomplete.cc])};Array.from(e).forEach(function(e){if(s(e),""!==e.dataset[P.dataset.bind.cc]){var t=y(e.dataset[P.dataset.bind.cc],P.regex.variable),r=t.obj,a=t.prop;n(r,a,e)}e.dataset[P.dataset.bindWrapped.cc]="true"}),e=document.querySelectorAll("["+P.dataset.bindIncomplete.dash+"]"),Array.from(e).forEach(function(e){var t=y(e.innerHTML,P.regex.obj),r=t.obj,a=t.prop;n(r,a,e)})}function y(e,t){var r=new RegExp(t,"g").exec(e),a=r[1].trim().split("."),i=n(a.shift()),o=i,c=void 0;return void 0!==i&&a.forEach(function(e,n){n<a.length-1?o=o[e]||o[P.iqdb][e][P.model]:c=e}),{obj:o,prop:c}}function h(e,n,o,u){o=Array.isArray(o)?o:E([o]),u=Array.isArray(u)?u:E([u]),t(e),r(e,n),a(e,n,o),i(e,n,u),c(e,n),f(e,n,d(e,n))}function g(e,n,t){h(e,n,null,t)}function v(n){Object.keys(n).forEach(function(t){e(t,n[t])}),"undefined"!=typeof document&&setTimeout(function(){p(),b()})}var m,q,A,_,P={iqdb:"__iqdb",model:"model",bindings:"bindings",watchers:"watchers",el:"el",attrs:"attrs",changer:"changer",value:"value",regex:{dataset:"^data-",variable:"([^{}]+)",obj:"{ *?([^{}]+) *?}"},dataset:{bindIncomplete:{cc:"iqBindIncomplete",dash:"data-iq-bind-incomplete"},bindTo:{cc:"iqBindTo",dash:"data-iq-bind-to"},bind:{cc:"iqBind",dash:"data-iq-bind"},bindWrapped:{cc:"iqBindWrapped",dash:"data-iq-bind-wrapped"}}},x={"input:not([type=checkbox])":(m={},_defineProperty(m,P.changer,["change","input"]),_defineProperty(m,P.value,"value"),m),"input[type=checkbox]":(q={},_defineProperty(q,P.changer,["change","input"]),_defineProperty(q,P.value,"checked"),q),textarea:(A={},_defineProperty(A,P.changer,["change","input"]),_defineProperty(A,P.value,"value"),A),"[contenteditable]":(_={},_defineProperty(_,P.changer,["change","input"]),_defineProperty(_,P.value,"textContent"),_)},E=function(e){return e.filter(function(e){return e})},w=function(e){return"string"==typeof e||"boolean"==typeof e?e:JSON.stringify(e,null,2)},j={};return{Bind:h,Watch:g,Model:v}}();