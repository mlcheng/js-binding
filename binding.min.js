"use strict";function _toConsumableArray(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);e<t.length;e++)n[e]=t[e];return n}return Array.from(t)}var iqwerty=iqwerty||{};iqwerty.binding=function(){function t(t,e){return!!e.find(function(e){return t.tagName.toLowerCase()===e})}function e(t,e){return e.some(function(e){return t.hasAttribute(e)})}function n(r,o,i,a){i instanceof Array||(i=[i]),n.prototype.setId(r),n.prototype.updateBindings(r[p],o,i,r[o],a),n.prototype.updateViews(r[p],o),i.forEach(function(n){n&&(t(n,["input","textarea"])||e(n,["contenteditable"]))&&n.addEventListener("input",function(){r[o]=n.innerHTML||n.value})}),Object.defineProperty(r,o,{get:function(){return n.prototype.Bindings[r[p]][o].value},set:function(t){var e=n.prototype.Bindings[r[p]][o];n.prototype.notifyWatchers(r[p],o,t,e.value),e.value=t,n.prototype.updateViews(r[p],o)},configurable:!0})}function r(t,e){return!!Object.keys(t).find(function(t){return e===t})}function o(t){setTimeout(function(){var e=document.querySelectorAll("["+f+"]");0!==e.length&&[].slice.call(e).forEach(function(e){var o=e.dataset.iqBind;if(o=new RegExp(d).exec(o)){var i=o[1];if(r(t,i)){var a=t[i];n(a,o[2],e)}}})},0)}function i(t){setTimeout(function(){var e=document.querySelectorAll("["+s+"]");0!==e.length&&[].slice.call(e).forEach(function(e){var o=e.dataset.iqBindScope,i="{ *?"+(o?c:d)+" *?}";i=new RegExp(i,"g");var a,u=[];do if(a=i.exec(e.innerHTML)){var p=o||a[1];if(!r(t,p))return;u.push({matched:a[0],obj:p,prop:(o?a[1]:a[2]).trim(),id:y+"-"+n.prototype.getId()})}while(a);if(0!==u.length){var f=e.innerHTML;u.forEach(function(t){var e=document.createElement("span");e.classList.add(y),e.id=t.id,f=f.replace(t.matched,e.outerHTML)}),e.innerHTML=f,u.forEach(function(e){var r=t[e.obj],o=document.getElementById(e.id);n(r,e.prop,o),o.removeAttribute("id")})}})},0)}function a(t){Object.keys(t).forEach(function(e){n.prototype.setId(t[e]),n.prototype.addBinding(t[e])}),o(t),i(t)}function u(t,e,r){n(t,e,null,r)}var p="$$id",c="([^.}]+)",d=c+"."+c,f="data-iq-bind",s="data-iq-bind-scope",y="iq-bind";return n.prototype.Bindings={},n.prototype.addBinding=function(t){var e=n.prototype.Bindings;e[t[p]]||(e[t[p]]={})},n.prototype.updateBindings=function(t,e,r,o,i){var a,u=n.prototype.Bindings;u[t]||(u[t]={}),u[t][e]||(u[t][e]={elems:[],value:o,watchers:[]}),(a=u[t][e].elems).push.apply(a,_toConsumableArray(r)),i&&u[t][e].watchers.push(i)},n.prototype.updateViews=function(e,r){var o,i=n.prototype.Bindings[e][r].elems;i.forEach(function(i){if(i){o=t(i,["input","textarea"])?"value":"innerHTML";var a=n.prototype.Bindings[e][r].value;i[o]!==a&&(i[o]=a)}})},n.prototype.notifyWatchers=function(t,e,r,o){var i=n.prototype.Bindings[t][e].watchers;i&&i.forEach(function(t){t(r,o)})},n.prototype._id=0,n.prototype.getId=function(){return n.prototype._id++},n.prototype.setId=function(t){null==t[p]&&Object.defineProperty(t,p,{value:n.prototype.getId()})},{Bind:n,Model:a,Watch:u}}();