"use strict";function _toConsumableArray(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var iqwerty=iqwerty||{};iqwerty.binding=function(){function e(e,t){j[e]=t}function t(e){return j[e]}function n(e){e.hasOwnProperty(P.iqdb)||(e[P.iqdb]={})}function r(e,t){if(!e[P.iqdb].hasOwnProperty(t)){var n;e[P.iqdb][t]=(n={},_defineProperty(n,P.model,e[t]),_defineProperty(n,P.bindings,[]),_defineProperty(n,P.watchers,[]),n)}}function i(e,t,n){var r=e[P.iqdb][t];n.forEach(function(n){var i=r[P.bindings].find(function(e){return e[P.el]===n[P.el]});if(i){var a;n[P.attrs]=n[P.attrs].filter(function(e){return!~i[P.attrs].indexOf(e)}),(a=i[P.attrs]).push.apply(a,_toConsumableArray(n[P.attrs]))}else{r[P.bindings]=r[P.bindings].concat(n);var o=Object.keys(x).find(function(e){return!!Array.from(n[P.el].parentElement.querySelectorAll(e)).find(function(e){return e===n[P.el]})});o&&x[o][P.changer].forEach(function(r){n[P.el].addEventListener(r,function(){e[t]=n[P.el][x[o][P.value]]})})}})}function a(e,t,n){var r,i=e[P.iqdb][t];i[P.watchers]=(r=i[P.watchers]).concat.apply(r,_toConsumableArray(n))}function o(e,t,n,r){n!==r&&e[P.iqdb][t][P.watchers].forEach(function(e){e(n,r)})}function c(e,t){try{Object.defineProperty(e,t,{get:function(){return e[P.iqdb][t][P.model]},set:function(n){var r=d(e,t);u(e,t,n),f(e,t,n),o(e,t,n,r)}})}catch(e){}}function d(e,t){return e[P.iqdb][t][P.model]}function u(e,t,n){e[P.iqdb][t][P.model]=n}function f(e,t,n){null==n&&(n=""),e[P.iqdb][t][P.bindings].forEach(function(e){e[P.attrs].forEach(function(t){var r=e[P.el];if(new RegExp(P.regex.dataset).test(t)){var i=t.replace(new RegExp(P.regex.dataset),"");r.dataset[i]!==n&&(r.dataset[i]=w(n))}else r[t]!==n&&(r[t]=w(n))})})}function l(e,t){return Array.from(t.querySelectorAll("*")).find(function(t){return!t.firstElementChild&&t.textContent===e})||t}function s(e){var t=new RegExp(P.regex.obj,"g"),n=e.innerHTML;n=n.replace(t,function(t){var n=l(t,e);return P.dataset.bindIncomplete.cc in n.dataset?t:"<span "+P.dataset.bindIncomplete.dash+">"+t+"</span>"}),e.innerHTML!==n&&(e.innerHTML=n)}function p(){var e=document.querySelectorAll("["+P.dataset.bindTo.dash+"]");Array.from(e).forEach(function(e){e.dataset[P.dataset.bindTo.cc].split(";").forEach(function(t){var n,r=t.split(":"),i=r[0].split(",");i=i.map(function(e){return e.trim()});var a=y(r[1],P.regex.variable),o=a.obj,c=a.prop;(o||c)&&h(o,c,(n={},_defineProperty(n,P.el,e),_defineProperty(n,P.attrs,i),n))})})}function b(){var e=document.querySelectorAll("["+P.dataset.bind.dash+"]:not(["+P.dataset.bindComplete.dash+"]"),t=function(e,t,n){var r;(e||t)&&(h(e,t,(r={},_defineProperty(r,P.el,n),_defineProperty(r,P.attrs,["innerHTML"]),r)),delete n.dataset[P.dataset.bindIncomplete.cc])};Array.from(e).forEach(function(e){if(s(e),""!==e.dataset[P.dataset.bind.cc]){var n=y(e.dataset[P.dataset.bind.cc],P.regex.variable),r=n.obj,i=n.prop;t(r,i,e)}e.dataset[P.dataset.bindComplete.cc]="true"}),e=document.querySelectorAll("["+P.dataset.bindIncomplete.dash+"]"),Array.from(e).forEach(function(e){var n=y(e.innerHTML,P.regex.obj),r=n.obj,i=n.prop;t(r,i,e)})}function y(e,n){var r=new RegExp(n,"g").exec(e),i=r[1].trim().split("."),a=t(i.shift()),o=a,c=void 0;return void 0!==a&&i.forEach(function(e,t){t<i.length-1?o=o[e]||o[P.iqdb][e][P.model]:c=e}),{obj:o,prop:c}}function h(e,t,o,u){o=Array.isArray(o)?o:E([o]),u=Array.isArray(u)?u:E([u]),n(e),r(e,t),i(e,t,o),a(e,t,u),c(e,t),f(e,t,d(e,t))}function g(e,t,n){h(e,t,null,n)}function m(t){Object.keys(t).forEach(function(n){e(n,t[n])}),"undefined"!=typeof document&&setTimeout(function(){p(),b()})}var v,q,A,_,P={iqdb:"__iqdb",model:"model",bindings:"bindings",watchers:"watchers",el:"el",attrs:"attrs",changer:"changer",value:"value",regex:{dataset:"^data-",variable:"([^{}]+)",obj:"{ *?([^{}]+) *?}"},dataset:{bindIncomplete:{cc:"iqBindIncomplete",dash:"data-iq-bind-incomplete"},bindTo:{cc:"iqBindTo",dash:"data-iq-bind-to"},bind:{cc:"iqBind",dash:"data-iq-bind"},bindComplete:{cc:"iqBindComplete",dash:"data-iq-bind-complete"}}},x={"input:not([type=checkbox])":(v={},_defineProperty(v,P.changer,["change","input"]),_defineProperty(v,P.value,"value"),v),"input[type=checkbox]":(q={},_defineProperty(q,P.changer,["change","input"]),_defineProperty(q,P.value,"checked"),q),textarea:(A={},_defineProperty(A,P.changer,["change","input"]),_defineProperty(A,P.value,"value"),A),"[contenteditable]":(_={},_defineProperty(_,P.changer,["change","input"]),_defineProperty(_,P.value,"textContent"),_)},E=function(e){return e.filter(function(e){return e})},w=function(e){return"string"==typeof e||"boolean"==typeof e?e:JSON.stringify(e,null,2)},j={};return{Bind:h,Watch:g,Model:m}}();